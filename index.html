<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>WebGIS RTLH Ngawi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>

<div class="topbar">
  <select id="tahun">
    <option value="2021">2021</option>
    <option value="2022">2022</option>
    <option value="2024">2024</option>
    <option value="2025" selected>2025</option>
  </select>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
var map = L.map('map').setView([-7.4,111.4],11);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

let geojsonLayer;
let dataGeojson;

// ambil warna
function getColor(jenis){
  return jenis === "RTLH" ? "red" : "blue";
}

// ukuran titik
function getRadius(jumlah){
  return jumlah ? Math.sqrt(jumlah) * 2 : 4;
}

// load data
fetch("DATA BSPS DAN RTLH.geojson")
.then(res=>res.json())
.then(data=>{
  dataGeojson = data;
  tampilkanTitik("2025");
});

// tampilkan titik
function tampilkanTitik(tahun){

  if(geojsonLayer) map.removeLayer(geojsonLayer);

  geojsonLayer = L.geoJSON(dataGeojson,{
    pointToLayer:function(feature,latlng){

      let rtlh = feature.properties["RTLH "+tahun] || 0;
      let bsps = feature.properties["BSPS "+tahun] || 0;

      let jumlah = rtlh + bsps;

      return L.circleMarker(latlng,{
        radius:getRadius(jumlah),
        fillColor: rtlh > 0 ? getColor("RTLH") : getColor("BSPS"),
        color:"#fff",
        weight:1,
        fillOpacity:0.8
      });
    },

    onEachFeature:function(feature,layer){

      let rtlh = feature.properties["RTLH "+tahun] || 0;
      let bsps = feature.properties["BSPS "+tahun] || 0;

      layer.bindPopup(
        "<b>Desa:</b> "+feature.properties.DESA+
        "<br><b>Kecamatan:</b> "+feature.properties.KECAMATAN+
        "<hr>"+
        "<b>RTLH "+tahun+":</b> "+rtlh+
        "<br><b>BSPS "+tahun+":</b> "+bsps
      );
    }

  }).addTo(map);
}

// filter tahun
document.getElementById("tahun").addEventListener("change",function(){
  tampilkanTitik(this.value);
});
</script>

</body>
</html>
